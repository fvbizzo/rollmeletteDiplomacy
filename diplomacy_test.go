package main

import (
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/gligneul/rollmelette"
	"github.com/stretchr/testify/suite"
)

var payload = common.Hex2Bytes("deadbeef")

// var msgSender = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafafa")
var Austria = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafaf1")
var England = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafaf2")
var France = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafaf3")
var Germany = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafaf4")
var Italy = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafaf5")
var Russia = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafaf6")
var Turkey = common.HexToAddress("0xfafafafafafafafafafafafafafafafafafafaf7")

var PassTurnPayloadSetup = []byte(`{"kind": "PassTurn", "payload": ""}`)

func TestMyApplicationSuite(t *testing.T) {
	suite.Run(t, new(MyApplicationSuite))
}

type MyApplicationSuite struct {
	suite.Suite
	tester *rollmelette.Tester
}

func (s *MyApplicationSuite) SetupTest() {
	app := NewGameApplication(Austria, England, France, Germany, Italy, Russia, Turkey, 5)
	s.tester = rollmelette.NewTester(app)
}

func (s *MyApplicationSuite) TestDeleteArmy() {
	s.tester.Advance(England, PassTurnPayloadSetup)
	s.tester.Advance(England, PassTurnPayloadSetup)
	input := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "England", "Delete": 4}}`
	result := s.tester.Advance(England, []byte(input))
	s.Nil(result.Err)
}

func (s *MyApplicationSuite) TestPassMoveTurn() {
	result := s.tester.Advance(England, PassTurnPayloadSetup)
	s.Nil(result.Err)
}

func (s *MyApplicationSuite) TestDeleteArmyWhereThereIsNone() {
	s.tester.Advance(England, PassTurnPayloadSetup)
	s.tester.Advance(England, PassTurnPayloadSetup)
	preinput := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "England", "Delete": 4}}`
	s.tester.Advance(England, []byte(preinput))
	input := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "England", "Delete": 4}}`
	result := s.tester.Advance(England, []byte(input))
	s.ErrorContains(result.Err, "cant delete an army in empty region")
}

// Testing the build army function
func (s *MyApplicationSuite) TestBuildArmy() {
	s.tester.Advance(England, PassTurnPayloadSetup)
	s.tester.Advance(England, PassTurnPayloadSetup)
	preinput := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "England", "Delete": 4}}`
	s.tester.Advance(England, []byte(preinput))
	input := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "England", "Delete": 0}}`
	result := s.tester.Advance(England, []byte(input))
	s.Nil(result.Err)
}

// Testing a player trying to build an army outside build phase
func (s *MyApplicationSuite) TestBuildArmyOutsideBuildPhase() {
	//s.tester.Advance(England, []byte(`{"kind": "PassTurn", "payload": ""}`))
	input := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "England", "Delete": 0}}`
	result := s.tester.Advance(England, []byte(input))
	s.ErrorContains(result.Err, "cant build an army outside build")

}

// Trying to build another player Army
func (s *MyApplicationSuite) TestBuildanotherPlayerArmy() {
	s.tester.Advance(England, []byte(`{"kind": "PassTurn", "payload": ""}`))
	s.tester.Advance(England, []byte(`{"kind": "PassTurn", "payload": ""}`))
	preinput := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "England", "Delete": 4}}`
	s.tester.Advance(England, []byte(preinput))
	input := `{"kind": "BuildArmy", "payload" : {"Type": "army", "Position": "London", "Owner": "France", "Delete": 0}}`
	result := s.tester.Advance(England, []byte(input))
	s.ErrorContains(result.Err, "cant build another player's army")
}

func (s *MyApplicationSuite) TestMoveArmy() {
	input := `{"kind": "MoveArmy", "payload" : {"UnitID": 4, "OrderType": "move", "OrderOwner": "England", "ToRegion": {"Name":"Wales"}, "FromRegion": {"Name": "London"}}}`
	s.tester.Advance(England, []byte(input))
	result := s.tester.Advance(England, PassTurnPayloadSetup)
	s.Nil(result.Err)
	expectedUnitsPosition := `{"1":{"ID":1,"type":"army","position":"Vienna","owner":"Austria","currentOrder":{"unitID":1,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"10":{"ID":10,"type":"army","position":"Berlin","owner":"Germany","currentOrder":{"unitID":10,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"11":{"ID":11,"type":"army","position":"Munich","owner":"Germany","currentOrder":{"unitID":11,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"12":{"ID":12,"type":"navy","position":"Kiel","owner":"Germany","currentOrder":{"unitID":12,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"13":{"ID":13,"type":"army","position":"Rome","owner":"Italy","currentOrder":{"unitID":13,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"14":{"ID":14,"type":"army","position":"Venice","owner":"Italy","currentOrder":{"unitID":14,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"15":{"ID":15,"type":"navy","position":"Naples","owner":"Italy","currentOrder":{"unitID":15,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"16":{"ID":16,"type":"Army","position":"Moscow","owner":"Russia","currentOrder":{"unitID":16,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"17":{"ID":17,"type":"navy","position":"St Petersburg","owner":"Russia","currentOrder":{"unitID":17,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"18":{"ID":18,"type":"army","position":"Warsaw","owner":"Russia","currentOrder":{"unitID":18,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"19":{"ID":19,"type":"navy","position":"Sevastopol","owner":"Russia","currentOrder":{"unitID":19,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"2":{"ID":2,"type":"army","position":"Budapest","owner":"Austria","currentOrder":{"unitID":2,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"20":{"ID":20,"type":"army","position":"Constantinople","owner":"Turkey","currentOrder":{"unitID":20,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"21":{"ID":21,"type":"army","position":"Smyrna","owner":"Turkey","currentOrder":{"unitID":21,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"22":{"ID":22,"type":"navy","position":"Ankara","owner":"Turkey","currentOrder":{"unitID":22,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"3":{"ID":3,"type":"navy","position":"Triest","owner":"Austria","currentOrder":{"unitID":3,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"4":{"ID":4,"type":"navy","position":"Wales","owner":"England","currentOrder":{"unitID":4,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"5":{"ID":5,"type":"army","position":"Liverpool","owner":"England","currentOrder":{"unitID":5,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"6":{"ID":6,"type":"navy","position":"Edinburgh","owner":"England","currentOrder":{"unitID":6,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"7":{"ID":7,"type":"army","position":"Paris","owner":"France","currentOrder":{"unitID":7,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"8":{"ID":8,"type":"navy","position":"Brest","owner":"France","currentOrder":{"unitID":8,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"9":{"ID":9,"type":"army","position":"Marseilles","owner":"France","currentOrder":{"unitID":9,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false}}`
	s.Equal(expectedUnitsPosition, string(result.Reports[0].Payload))
}

func (s *MyApplicationSuite) TestUnitBounce() {
	input := `{"kind": "MoveArmy", "payload" : {"UnitID": 4, "OrderType": "move", "OrderOwner": "England", "ToRegion": {"Name":"Enlish Channel"}, "FromRegion": {"Name": "London"}}}`
	input2 := `{"kind": "MoveArmy", "payload" : {"UnitID": 8, "OrderType": "move", "OrderOwner": "France", "ToRegion": {"Name":"Enlish Channel"}, "FromRegion": {"Name": "Brest"}}}`
	s.tester.Advance(England, []byte(input))
	s.tester.Advance(France, []byte(input2))
	result := s.tester.Advance(England, []byte(`{"kind": "PassTurn", "payload": ""}`))
	s.Nil(result.Err)
	expectedUnitsPosition := `{"1":{"ID":1,"type":"army","position":"Vienna","owner":"Austria","currentOrder":{"unitID":1,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"10":{"ID":10,"type":"army","position":"Berlin","owner":"Germany","currentOrder":{"unitID":10,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"11":{"ID":11,"type":"army","position":"Munich","owner":"Germany","currentOrder":{"unitID":11,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"12":{"ID":12,"type":"navy","position":"Kiel","owner":"Germany","currentOrder":{"unitID":12,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"13":{"ID":13,"type":"army","position":"Rome","owner":"Italy","currentOrder":{"unitID":13,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"14":{"ID":14,"type":"army","position":"Venice","owner":"Italy","currentOrder":{"unitID":14,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"15":{"ID":15,"type":"navy","position":"Naples","owner":"Italy","currentOrder":{"unitID":15,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"16":{"ID":16,"type":"Army","position":"Moscow","owner":"Russia","currentOrder":{"unitID":16,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"17":{"ID":17,"type":"navy","position":"St Petersburg","owner":"Russia","currentOrder":{"unitID":17,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"18":{"ID":18,"type":"army","position":"Warsaw","owner":"Russia","currentOrder":{"unitID":18,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"19":{"ID":19,"type":"navy","position":"Sevastopol","owner":"Russia","currentOrder":{"unitID":19,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"2":{"ID":2,"type":"army","position":"Budapest","owner":"Austria","currentOrder":{"unitID":2,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"20":{"ID":20,"type":"army","position":"Constantinople","owner":"Turkey","currentOrder":{"unitID":20,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"21":{"ID":21,"type":"army","position":"Smyrna","owner":"Turkey","currentOrder":{"unitID":21,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"22":{"ID":22,"type":"navy","position":"Ankara","owner":"Turkey","currentOrder":{"unitID":22,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"3":{"ID":3,"type":"navy","position":"Triest","owner":"Austria","currentOrder":{"unitID":3,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"4":{"ID":4,"type":"navy","position":"London","owner":"England","currentOrder":{"unitID":4,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"5":{"ID":5,"type":"army","position":"Liverpool","owner":"England","currentOrder":{"unitID":5,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"6":{"ID":6,"type":"navy","position":"Edinburgh","owner":"England","currentOrder":{"unitID":6,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"7":{"ID":7,"type":"army","position":"Paris","owner":"France","currentOrder":{"unitID":7,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"8":{"ID":8,"type":"navy","position":"Brest","owner":"France","currentOrder":{"unitID":8,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"9":{"ID":9,"type":"army","position":"Marseilles","owner":"France","currentOrder":{"unitID":9,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false}}`
	s.Equal(expectedUnitsPosition, string(result.Reports[0].Payload))
}

func (s *MyApplicationSuite) TestSupportMoveSuccess() {
	input1 := `{"kind": "MoveArmy", "payload" : {"UnitID": 1, "OrderType": "move", "OrderOwner": "Austria", "ToRegion": {"Name":"Tyrolia"}, "FromRegion": {"Name": "Vienna"}}}`
	input2 := `{"kind": "MoveArmy", "payload" : {"UnitID": 3, "OrderType": "move", "OrderOwner": "Austria", "ToRegion": {"Name":"Venice"}, "FromRegion": {"Name": "Trieste"}}}`
	r1 := s.tester.Advance(Austria, []byte(input1))
	s.Nil(r1.Err)
	s.tester.Advance(Austria, []byte(input2))
	result := s.tester.Advance(Austria, PassTurnPayloadSetup)
	expectedUnitsPosition := `{"1":{"ID":1,"type":"army","position":"Tyrolia","owner":"Austria","currentOrder":{"unitID":1,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"10":{"ID":10,"type":"army","position":"Berlin","owner":"Germany","currentOrder":{"unitID":10,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"11":{"ID":11,"type":"army","position":"Munich","owner":"Germany","currentOrder":{"unitID":11,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"12":{"ID":12,"type":"navy","position":"Kiel","owner":"Germany","currentOrder":{"unitID":12,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"13":{"ID":13,"type":"army","position":"Rome","owner":"Italy","currentOrder":{"unitID":13,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"14":{"ID":14,"type":"army","position":"Venice","owner":"Italy","currentOrder":{"unitID":14,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"15":{"ID":15,"type":"navy","position":"Naples","owner":"Italy","currentOrder":{"unitID":15,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"16":{"ID":16,"type":"Army","position":"Moscow","owner":"Russia","currentOrder":{"unitID":16,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"17":{"ID":17,"type":"navy","position":"St Petersburg","owner":"Russia","currentOrder":{"unitID":17,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"18":{"ID":18,"type":"army","position":"Warsaw","owner":"Russia","currentOrder":{"unitID":18,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"19":{"ID":19,"type":"navy","position":"Sevastopol","owner":"Russia","currentOrder":{"unitID":19,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"2":{"ID":2,"type":"army","position":"Budapest","owner":"Austria","currentOrder":{"unitID":2,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"20":{"ID":20,"type":"army","position":"Constantinople","owner":"Turkey","currentOrder":{"unitID":20,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"21":{"ID":21,"type":"army","position":"Smyrna","owner":"Turkey","currentOrder":{"unitID":21,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"22":{"ID":22,"type":"navy","position":"Ankara","owner":"Turkey","currentOrder":{"unitID":22,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"3":{"ID":3,"type":"navy","position":"Triest","owner":"Austria","currentOrder":{"unitID":3,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"4":{"ID":4,"type":"navy","position":"London","owner":"England","currentOrder":{"unitID":4,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"5":{"ID":5,"type":"army","position":"Liverpool","owner":"England","currentOrder":{"unitID":5,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"6":{"ID":6,"type":"navy","position":"Edinburgh","owner":"England","currentOrder":{"unitID":6,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"7":{"ID":7,"type":"army","position":"Paris","owner":"France","currentOrder":{"unitID":7,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"8":{"ID":8,"type":"navy","position":"Brest","owner":"France","currentOrder":{"unitID":8,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false},"9":{"ID":9,"type":"army","position":"Marseilles","owner":"France","currentOrder":{"unitID":9,"orderType":"hold","orderOwner":"","toRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null},"fromRegion":{"name":"","occupied":false,"owner":"","supplyCenter":false,"coastal":false,"sea":false,"frontiers":null}},"retreating":false}}`
	s.Equal(expectedUnitsPosition, string(result.Reports[0].Payload))
	s.Nil(result.Err)

}

func (s *MyApplicationSuite) TestInspect() {
	result := s.tester.Inspect(payload)
	s.Nil(result.Err)
}
